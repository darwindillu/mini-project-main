<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShoppeE</title>
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/profileedit.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>

<body>

  <style>
    @import url('https://fonts.googleapis.com/css?family=Open+Sans&display=swap');body{background-color: #eeeeee;font-family: 'Open Sans',serif}.container{margin-top:50px;margin-bottom: 50px}.card{position: relative;display: -webkit-box;display: -ms-flexbox;display: flex;-webkit-box-orient: vertical;-webkit-box-direction: normal;-ms-flex-direction: column;flex-direction: column;min-width: 0;word-wrap: break-word;background-color: #fff;background-clip: border-box;border: 1px solid rgba(0, 0, 0, 0.1);border-radius: 0.10rem}.card-header:first-child{border-radius: calc(0.37rem - 1px) calc(0.37rem - 1px) 0 0}.card-header{padding: 0.75rem 1.25rem;margin-bottom: 0;background-color: #fff;border-bottom: 1px solid rgba(0, 0, 0, 0.1)}.track{position: relative;background-color: #ddd;height: 7px;display: -webkit-box;display: -ms-flexbox;display: flex;margin-bottom: 60px;margin-top: 50px}.track .step{-webkit-box-flex: 1;-ms-flex-positive: 1;flex-grow: 1;width: 25%;margin-top: -18px;text-align: center;position: relative}.track .step.active:before{background: #FF5722}.track .step::before{height: 7px;position: absolute;content: "";width: 100%;left: 0;top: 18px}.track .step.active .icon{background: #ee5435;color: #fff}.track .icon{display: inline-block;width: 40px;height: 40px;line-height: 40px;position: relative;border-radius: 100%;background: #ddd}.track .step.active .text{font-weight: 400;color: #000}.track .text{display: block;margin-top: 7px}.itemside{position: relative;display: -webkit-box;display: -ms-flexbox;display: flex;width: 100%}.itemside .aside{position: relative;-ms-flex-negative: 0;flex-shrink: 0}.img-sm{width: 80px;height: 80px;padding: 7px}ul.row, ul.row-sm{list-style: none;padding: 0}.itemside .info{padding-left: 15px;padding-right: 7px}.itemside .title{display: block;margin-bottom: 5px;color: #212529}p{margin-top: 0;margin-bottom: 1rem}.btn-warning{color: #ffffff;background-color: #ee5435;border-color: #ee5435;border-radius: 1px}.btn-warning:hover{color: #ffffff;background-color: #ff2b00;border-color: #ff2b00;border-radius: 1px}
  </style>

    <style>
        .gradient-custom-2 {
/* fallback for old browsers */
background: #a1c4fd;

/* Chrome 10-25, Safari 5.1-6 */
background: -webkit-linear-gradient(to right, rgba(161, 196, 253, 1), rgba(194, 233, 251, 1));

/* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
background: linear-gradient(to right, rgba(161, 196, 253, 1), rgba(194, 233, 251, 1))
}

#progressbar-1 {
color: #455A64;
}

#progressbar-1 li {
list-style-type: none;
font-size: 13px;
width: 33.33%;
float: left;
position: relative;
}

#progressbar-1 #step1:before {
content: "1";
color: #fff;
width: 29px;
margin-left: 22px;
padding-left: 11px;
}

#progressbar-1 #step2:before {
content: "2";
color: #fff;
width: 29px;
}

#progressbar-1 #step3:before {
content: "3";
color: #fff;
width: 29px;
margin-right: 22px;
text-align: center;
}

#progressbar-1 li:before {
line-height: 29px;
display: block;
font-size: 12px;
background: #455A64;
border-radius: 50%;
margin: auto;
}

#progressbar-1 li:after {
content: '';
width: 121%;
height: 2px;
background: #455A64;
position: absolute;
left: 0%;
right: 0%;
top: 15px;
z-index: -1;
}

#progressbar-1 li:nth-child(2):after {
left: 50%
}

#progressbar-1 li:nth-child(1):after {
left: 25%;
width: 121%
}

#progressbar-1 li:nth-child(3):after {
left: 25%;
width: 50%;
}

#progressbar-1 li.active:before,
#progressbar-1 li.active:after {
background: #1266f1;
}

.card-stepper {
z-index: 0
}
    </style>
    <style>
        .gradient-custom {
        /* fallback for old browsers */
        background: #cd9cf2;

        /* Chrome 10-25, Safari 5.1-6 */
        background: -webkit-linear-gradient(to top left, rgba(205, 156, 242, 1), rgba(246, 243, 255, 1));

        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        background: linear-gradient(to top left, rgba(205, 156, 242, 1), rgba(246, 243, 255, 1))
        }
    </style>

    <style>


h1 {
  font-family: 'Montserrat', sans-serif;
  color: #fff;
}

/* You just need to get this field - start */

.search-box {
  width: 350px;
  position: relative;
  display: flex;
	bottom: 0;
	left: 0;
	right: 0;
	margin: auto;
}

.search-input {
  width: 100%;
  font-family: 'Montserrat', sans-serif;
  font-size: 16px;
  padding: 15px 45px 15px 15px;
  background-color: #afafc2;
  color: #6c6c6c;
  border-radius: 6px;
  border:none;
  transition: all .4s;
}

.search-input:focus {
  border:none;
  outline:none;
  box-shadow: 0 1px 12px #b8c6db;
  -moz-box-shadow: 0 1px 12px #b8c6db;
  -webkit-box-shadow: 0 1px 12px #b8c6db;
}

.search-btn {
  background-color: transparent;
  font-size: 18px;
  padding: 6px 9px;
  margin-left:-45px;
  border:none;
  color: #6c6c6c;
  transition: all .4s;
  z-index: 10;
}

.search-btn:hover {
  transform: scale(1.2);
  cursor: pointer;
  color: black;
}

.search-btn:focus {
  outline:none;
  color:black;
}

    </style>
    
    <div class="container-xl px-4 mt-4">
        <!-- Account page navigation-->
        <nav class="nav nav-borders">
            <a class="nav-link ms-0" href="/user/profile/<%= userId %>" >Profile</a>
            <a class="nav-link " href="/user/wallet">Wallet</a>

            <a class="nav-link" href="/" >Home</a>
        </nav>
        <hr class="mt-0 mb-4">
        <div class="row">
            <section class="h-100 gradient-custom">
              <!-- You just need to get this field. Start -->
<script src="https://kit.fontawesome.com/d97b87339f.js" crossorigin="anonymous"></script>

<!-- <div style="margin-top: 50px;" class="search-box">
  <input onkeyup="sendData(this)" name="name" class="search-input" type="text" placeholder="Search something..">
  <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
</div>

<section id="searchresult"></section> -->

  

<!-- You just need to get this field. End -->
                <div class="container py-5 h-100">
                  <div class="row d-flex justify-content-center align-items-center h-100">
                    <div class="col-lg-10 col-xl-8">
                      <div class="card" style="border-radius: 10px;">
                        <% let index = 0; %>
                        <% orders.forEach(function(order) { %>
                            <div class="card-body p-4">
                          <div class="card shadow-0 border mb-4">
                            <div class="card-body">
                              <div class="row">
                                <!-- <div class="col-md-2">
                                  <img width="60px" src="<%= order.images %>"
                                    class="img-fluid">
                                </div> -->
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <a style="text-decoration: none; color: black;" href="/user/productdetail/<%= order.productid %>"><%= order.productName %></a>
                                  </div>
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <p class="text mb-0 small">Date: <%= order.date %></p>
                                  </div>
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <p class="text mb-0 small">Method: <%= order.payment %></p>
                                  </div>
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <p class="text mb-0 small">Qty: <%= order.quantity %></p>
                                  </div>
                                  
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <p class=" mb-0 small">total: <i style="color: red;"><%= order.productprice * order.quantity %></i></p>

                                    <p hidden><%= order.productid %></p>
                                  </div>
                                  <% if(order.status == 'Delivered'){ %>
                                    <div>
                                      <button style="width:150px; height: 50px; margin-top: 25px; " onclick="invoice('<%= order._id %>')">INVOICE</button>
  
                                    </div>
                                 <% } %>
                       
                                  <% if (order.status === 'Cancelled') { %>
                                    <div class="d-flex justify-content-end align-items-end">
                                      <p class="text mb-0 small">status: <i style="color: red;"><%= order.status %></i></p>
                                    </div>
                                  <% } else { %>
                                    <div class="d-flex justify-content-end align-items-end">
                                      <p class="text mb-0 small">status: <i style="color: rgb(36, 150, 36);"><%= order.status %></i></p>
                                    </div>
                                  <% } %>
                              </div>
                              <hr class="mb-4" style="background-color: #e0e0e0; opacity: 1;">
                              <div style="margin-top: -15px;" class="row d-flex align-items-center">
                                 <div>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal<%= index %>">
                                    Order Details
                                </button>
                                
                                <!-- Modal -->
                                <div class="modal fade" id="exampleModal<%= index %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Order Details</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="card card-stepper" style="border-radius: 16px;">
                                                <div class="card-header p-4">
                                                  <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                      <p class="text-muted mb-2"> Order ID <span class="fw-bold text-body"><%= order.id %></span></p>
                                                      <p class="text-muted mb-0"> Place On <span class="fw-bold text-body"><%= order.date %></span> </p>
                                                    </div>
                                                  </div>
                                                </div>
                                                <div class="card-body p-4">
                                                  <div class="d-flex flex-row mb-4 pb-2">
                                                    <div class="flex-fill">
                                                      <h5 class="bold"><%= order.productName %></h5>
                                                      <p class="text-muted"> Qt: <%= order.quantity %></p>
                                                      <h4 class="mb-3">&#8377;<%= order.realPrice %><span class="small text-muted"> via (<%= order.payment %>) </span></h4>
                                                      <!-- <p class="text-muted">Tracking Status on: <span class="text-body">11:30pm, Today</span></p> -->
                                                    </div>
                                                    <div>
                                                      <img class="align-self-center img-fluid"
                                                        src="<%= order.images %>" width="70">
                                                    </div>
                                                  </div>

                                                  <div class="track">
                                                    <% if (order.status == 'Pending') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step "> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step "> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <% } else if (order.status == 'Shipped') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step "> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <% } else if(order.status == 'Out for delivery') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <% } else if(order.status == 'Delivered') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <% }else if(order.status=='Return Requested'){ %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Return Requested</span> </div>

                                                    <% }else if(order.status =='Return Request Rejected'){ %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Return Requested</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Request Rejected</span> </div>

                                                   <% }else if(order.status =='Approved'){ %>
                                                    <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                    <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                    <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                    <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Return Requested</span> </div>
                                                    <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Request Approved</span> </div>
                                                  <% } else { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-times"></i> </span> <span class="text">Cancelled</span> </div>
                                                    <% } %>
                                                </div>
                                                </div>
                                                <div class="card-footer p-4">
                                                  <div class="d-flex justify-content-between">
                                                    <% if (order.status != 'Cancelled' && order.status != 'Delivered' && order.status!='Return Requested' && order.status!='Return Request Rejected' && order.status!='Approve' && order.status != 'Reject') { %>
                                                    <h5 class="fw-normal mb-0"><a style="text-decoration: none; cursor: pointer;" onclick="cancel_order('/user/cancelorder/<%= order._id %>')">Cancel Order</a>
                                                    </h5>
                                                    <% } %>
                                                    <% if (order.status == 'Delivered'){ %>
                                                      
                                                      <h5 class="fw-normal mb-0"><a style="text-decoration: none; cursor: pointer;" onclick="return_order(`/user/return/<%= order._id %>/<%= order.productName %>`)">Return Product</a>
                                                      </h5> 
                                                  <% } %>
                                                  <% if (order.status== 'Return Requested'){ %>
                                                    <h5 class="fw-normal mb-0"><a style="text-decoration: none; cursor: pointer;" onclick="cancel_return(`/user/cancelReturn/<%= order._id %>/<%= order.productName %>`)">Cancel Return </a>
                                                    </h5> 

                                                 <% } %>
                                                    <div class="border-start h-100"></div>
                                                    <!-- <h5 class="fw-normal mb-0"><a href="#!">Cancel</a></h5> -->
                                                    <div class="border-start h-100"></div>
                                                    <!-- <h5 class="fw-normal mb-0"><a href="#!">Pre-pay</a></h5> -->
                                                    <div class="border-start h-100"></div>
                                                    <!-- <h5 class="fw-normal mb-0"><a href="#!" class="text-muted"><i class="fas fa-ellipsis-v"></i></a>
                                                    </h5> -->
                                                  </div>
                                                </div>
                                              </div>
                                        </div>
                                        <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <% index++; %>
                        <% }); %>
                      </div>
                    </div>
                  </div>
                </div>
                <nav aria-label="...">
                  <ul class="pagination pagination-lg">
                    <ul class="pagination">
                      <% if(pages) { %>
                        <% const totalPages = Math.ceil(pages); %>
                        <% const maxPagesToShow = 5; %>
                        <% const startPage = Math.max(0, pagenum - Math.floor(maxPagesToShow / 2)); %>
                        <% const endPage = Math.min(totalPages - 1, startPage + maxPagesToShow - 1); %>
                    
                        <% if (startPage > 0) { %>
                          <li class="page-item">
                            <a class="page-link" href="/user/orderspage?page=<%= startPage - 1 %>" tabindex="-1">Previous</a>
                          </li>
                        <% } %>
                    
                        <% for(let i = startPage; i <= endPage; i++) { %>
                          <% if (pagenum === i) { %> 
                            <li class="page-item active">
                              <a class="page-link" href="/user/orderspage?page=<%= i %>" tabindex="-1"><%= i + 1 %></a>
                            </li>
                          <% } else { %> 
                            <li class="page-item">
                              <a class="page-link" href="/user/orderspage?page=<%= i %>" tabindex="-1"><%= i + 1 %></a>
                            </li>
                          <% } %>
                        <% } %>
                    
                        <% if (endPage < totalPages - 1) { %>
                          <li class="page-item">
                            <a class="page-link" href="/user/orderspage?page=<%= endPage + 1 %>" tabindex="-1">Next</a>
                          </li>
                        <% } %>
                    
                      <% } %>
                    </ul>
                    
                  </ul>
                </nav>
              </section>           
        </div>
    </div>

    <script src="https://unpkg.com/easyinvoice/dist/easyinvoice.min.js"></script>

    <script>
     // ...

async function invoice(id) {
  try {
    const response = await fetch(`/user/myInvoice/${id}`, { method: 'get' });

    if (!response.ok) {
      throw new Error(`Fetch request failed with status: ${response.status}`);
    }

    const data = await response.json();
    console.log('Received data:', data);

    // Check if 'refference' matches the expected data structure
    // Ensure that it contains the necessary invoice details

    // Generate and download the invoice
    easyinvoice.createInvoice(data, function (result) {
      console.log('Generated invoice:', result);
      easyinvoice.download('myInvoice.pdf', result.pdf);
    });
  } catch (error) {
    console.error(error);
    // Handle any errors, e.g., show an error message to the user
  }
}

// ...

    </script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script>
      function cancel_order(orderUrl) {
        swal({
          title: 'Are you sure?',
          text: 'You want to cancel the order!',
          buttons: true,
          dangerMode: true
        }).then((willDelete) => {
          if (willDelete) {
            // Navigate to the specified URL
            window.location.href = orderUrl;
          }
        });
      }

      function return_order(orderUrl) {
        swal({
          title: 'Are you sure?',
          text: 'You want to return the order!',
          buttons: true,
          dangerMode: true
        }).then((willDelete) => {
          if (willDelete) {
            window.location.href = orderUrl;
          }
        });
      }

      function cancel_return(orderUrl) {
        swal({
          title: 'Are you sure?',
          text: 'You want to cancel the return!',
          buttons: true,
          dangerMode: true
        }).then((willDelete) => {
          if (willDelete) {
            window.location.href = orderUrl;
          }
        });
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>



</html>